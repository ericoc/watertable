
<!DOCTYPE html>
<html lang="en" class="dark" data-bs-theme="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Eric O'Callaghan">
        <meta name="description" content="Water Table">
        <meta name="format-detection" content="telephone=no">
        <meta name="robots" content="noindex,nofollow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://water.ericoc.com/logo.png">
        <meta property="og:site_name" content="ðŸ’§ Water Table ðŸš°">
        <meta property="og:title" content="ðŸ’§ Water Table ðŸš°">
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="apple-touch-icon" href="logo.png">
        <title>ðŸ’§ Water Table ðŸš°</title>
        <script src="/jquery-3.7.1.min.js"></script>
        <script src="/luxon.min.js"></script>
        <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="bootstrap-icons/font/bootstrap-icons.min.css">
        <link href="/datatables/datatables.min.css" rel="stylesheet">
        <script src="/datatables/datatables.min.js"></script>
        <script src="/datatables/sum.js"></script>
        <style>nav a:hover { opacity: 50%; }</style>
    </head>
    <body>
        <header class="container-lg header">
            <nav class="navbar navbar-dark">
                <a class="nav-link navbar-brand" href="index.html" title="ðŸ’§ Water Table ðŸš°">
                    ðŸ’§ Water Table ðŸš°
                </a>
            </nav>
        </header>
        <main class="container-lg">

            <table class="display table table-borderless table-dark table-responsive table-sm table-striped" id="waterTable">
                <thead class="h6">
                    <tr>
                        <th title="Date">Date</th>
                        <th title="Gallons">Gallons</th>
                    </tr>
                </thead>
                <tbody>
                <!--
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                -->
                </tbody>
                <tfoot class="h6">
                    <tr class="table-group-divider" id="page-total-row">
                        <td><b>Total</b>:</td>
                        <td id="page-gallons"></td>
                    </tr>
                    <tr id="all-total-row">
                        <td><b>All</b>:</td>
                        <td id="total-gallons"></td>
                    </tr>
                </tfoot>
            </table>
            <script>
                const DateTime = luxon.DateTime;
                const pageGallonsNode = document.getElementById('page-gallons')
                const totalGallonsNode = document.getElementById('total-gallons')
                async function footerTotal (api, col=1, digits=4) {
                    let pageGallons = DataTable.render.number(',', '.', digits).display(api.column(col, {page: 'current'}).data().sum())
                    pageGallonsNode.innerHTML = `<code class="fw-bolder" title="Total: ${pageGallons} Gallons">${pageGallons}</code>`
                    pageGallonsNode.title = `Total: ${pageGallons} Gallons (on this page)`
                    let totalGallons = DataTable.render.number(',', '.', digits).display(api.column(col).data().sum())
                    totalGallonsNode.innerHTML = `<code class="fw-bolder">${totalGallons}</code>`
                    totalGallonsNode.title = `All: ${totalGallons} Total Gallons`
                }

                const defaultLength = 10
                const exportFileName = 'WaterTable'
                const resultName = 'days'
                new DataTable('#waterTable', {
                    ajax: { url: 'water.json', dataSrc: '' },
                    columns: [
                        {
                            data: 'date',
                            render: DataTable.render.date('yyyy-MM-dd', 'DDDD', 'en')
                        },
                        {
                            data: 'gallons',
                            render: (data, type) => {
                                if (type === 'display') {
                                    let gallonText = 'primary'
                                    if (data > 100) {
                                        gallonText = 'danger'
                                    } else if (data > 75) {
                                        gallonText = 'warning'
                                    } else if (data > 50) {
                                        gallonText = 'info'
                                    }
                                    return `<code class="fw-bold text-${gallonText}-emphasis" title="${data} gallons">${data}</code>`
                                }
                                return data
                            }
                        }
                    ],
                    footerCallback: async function () {
                        await footerTotal(this.api())
                    },
                    language: {
                        'emptyTable': `No ${resultName} available in table`,
                        'info': `Showing _START_ to _END_ of _TOTAL_ ${resultName}`,
                        'infoEmpty': `Showing 0 to 0 of 0 ${resultName}`,
                        'infoFiltered': `(filtered from _MAX_ total ${resultName})`,
                        'lengthMenu': `_MENU_ ${resultName}`,
                        'zeroRecords': `No matching ${resultName} found`,
                        searchBuilder: {'title': null}
                    },
                    layout: {
                        topStart: {buttons: [{
                            extend: 'searchBuilder',
                            config: {depthLimit: 1},
                        }]},
                        topEnd: {buttons: [
                            {
                                extend: 'copyHtml5',
                                text: '<span class="bi bi-clipboard" title="Copy rows to clipboard"> Copy</span>',
                                title: exportFileName
                            },
                            {
                                extend: 'csvHtml5',
                                text: '<span class="bi bi-filetype-csv" title="Comma-Separated Values (.csv)"> CSV</span>',
                                title: exportFileName
                            },
                            {
                                extend: 'excelHtml5',
                                text: '<span class="bi bi-filetype-xlsx" title="Excel (.xlsx)"> Excel</span>',
                                title: exportFileName
                            },
                            {
                                extend: 'pdfHtml5',
                                text: '<span class="bi bi-filetype-pdf" title="Portable Data Format (.pdf)"> PDF</span>',
                                title: exportFileName
                            },
                            {
                                extend: 'print',
                                text: '<span class="bi bi-printer" title="Print"> Print</span>'
                            },
                        ]},
                        bottomStart: 'pageLength',
                        bottom1: 'paging',
                        bottomEnd: 'info'
                    },
                    lengthMenu: [
                        5,
                        {label: `${defaultLength} (default)`, value: defaultLength},
                        15, 20, 25, 50, 75, 100,
                        {label: 'all', value: -1}
                    ],
                    order: [[0, 'desc']],
                    pageLength: defaultLength,
                })
            </script>

        </main>
    </body>
</html>
