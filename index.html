
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark" class="dark">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Eric O'Callaghan">
        <meta name="description" content="Water Table">
        <meta name="format-detection" content="telephone=no">
        <meta name="robots" content="noindex,nofollow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://water.ericoc.com/logo.png">
        <meta property="og:site_name" content="ðŸ’§ Water Table ðŸš°">
        <meta property="og:title" content="ðŸ’§ Water Table ðŸš°">
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="apple-touch-icon" href="logo.png">
        <title>ðŸ’§ Water Table ðŸš°</title>
        <script src="/jquery-3.7.1.min.js"></script>
        <script src="/luxon.min.js"></script>
        <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
        <link href="/datatables/datatables.min.css" rel="stylesheet">
        <script src="/datatables/datatables.min.js"></script>
        <script src="/datatables/sum.js"></script>
        <style>
            nav a:hover { opacity: 50%; }
        </style>
    </head>
    <body>
        <header class="container-lg header">
            <nav class="navbar navbar-dark">
                <a class="nav-link navbar-brand" href="index.html" title="ðŸ’§ Water Table ðŸš°">
                    ðŸ’§ Water Table ðŸš°
                </a>
            </nav>
        </header>
        <main class="container-lg">

            <table class="display table table-borderless table-sm table-striped" id="waterTable">
                <caption class="caption-top">
                    <span id="minimumDate"></span>
                    &mdash;
                    <span id="maximumDate"></span>
                </caption>
                <thead>
                    <tr>
                        <th title="Date">Date</th>
                        <th title="Gallons">Gallons</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                <tr class="table-group-divider">
                    <td></td>
                    <td></td>
                </tr>
                </tfoot>
            </table>
            <script>
                let DateTime = luxon.DateTime;
                const hugeDateFmt = DateTime.DATE_HUGE

                async function dateDisplay (api, col=0) {
                    let days = api.column(col).data()
                    let minDate = null
                    let maxDate = null
                    for (let i = 0; i < days.length; i++) {
                        if (days[i]) {
                            let testDay = DateTime.fromISO(days[i])
                            if (testDay) {
                                if (minDate == null || testDay < minDate) {
                                    minDate = testDay
                                }
                                if (maxDate == null || testDay > maxDate) {
                                    maxDate = testDay
                                }
                            }
                        }
                    }
                    if (minDate) {
                        document.getElementById('minimumDate').innerHTML = `<time datetime="${minDate.toISODate()}">${minDate.toLocaleString(hugeDateFmt)}</time>`
                    }
                    if (maxDate) {
                        document.getElementById('maximumDate').innerHTML = `<time datetime="${maxDate.toISODate()}">${maxDate.toLocaleString(hugeDateFmt)}</time>`
                    }
                }

                async function footerTotal (api, col=1) {
                    let totalGallons = DataTable.render.number(',', '.', 4).display(api.column(col, {page: 'current'}).data().sum())
                    api.column(col).footer().innerHTML = `<code class="font-monospace fw-bolder text-bg-dark" title="${totalGallons} total gallons">${totalGallons}</code>`
                }

                new DataTable('#waterTable', {
                    ajax: {
                        url: 'water.json',
                        dataSrc: ''
                    },
                    columns: [
                        {
                            data: 'Date',
                            render: function (data, type) {
                                if (type === 'display') {
                                    let day = new DateTime.fromISO(data).toLocaleString(hugeDateFmt)
                                    return `<time datetime="${data}">${day}</time>`
                                }
                                return data
                            },
                        },
                        {
                            data: 'Gallons',
                            render: function (data, type) {
                                if (type === 'display') {
                                    let gallonText = 'primary'
                                    if (data > 100) {
                                        gallonText = 'danger'
                                    } else if (data > 75) {
                                        gallonText = 'warning'
                                    } else if (data > 50) {
                                        gallonText = 'info'
                                    }
                                    return `<code class="font-monospace text-${gallonText}-emphasis" title="${data} gallons">${data}</code>`
                                }
                                return data
                            },
                            type: 'num',
                        }
                    ],
                    drawCallback: async function () {
                        await dateDisplay(this.api())
                    },
                    footerCallback: async function () {
                        await footerTotal(this.api())
                    },
                    language: {
                        'emptyTable': 'No days available in table',
                        'info': 'Showing _START_ to _END_ of _TOTAL_ days',
                        'infoEmpty': 'Showing 0 to 0 of 0 days',
                        'infoFiltered': '(filtered from _MAX_ total days)',
                        'lengthMenu': '_MENU_ days',
                        'zeroRecords': 'No matching days found',
                        searchBuilder: { title: '' }
                    },
                    layout: {
                        topStart: 'searchBuilder',
                        topEnd: {buttons: ['csvHtml5', 'excelHtml5', 'print']},
                        bottomStart: 'pageLength',
                        bottom1: 'paging',
                        bottomEnd: 'info'
                    },
                    lengthMenu: [
                        5, {label: '10 (default)', value: 10},
                        15, 20, 25, 50, 75, 100, {label: 'all', value: -1}
                    ],
                    order: [[0, 'desc']],
                    pageLength: 10,
                    searchBuilder: {depthLimit: 1},
                })
            </script>

        </main>
    </body>
</html>
