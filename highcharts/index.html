<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Eric O'Callaghan">
        <meta name="description" content="Water HighChart">
        <meta name="format-detection" content="telephone=no">
        <meta name="robots" content="noindex,nofollow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://water.ericoc.com/logo.png">
        <meta property="og:site_name" content="ðŸ’§ Water HighChart ðŸš°">
        <meta property="og:title" content="ðŸ’§ Water HighChart ðŸš°">
        <link rel="shortcut icon" href="/favicon.ico">
        <link rel="apple-touch-icon" href="/logo.png">
        <title>ðŸ’§ Water HighChart ðŸš°</title>
        <script src="/jquery-3.7.1.min.js"></script>
        <script src="/luxon.min.js"></script>
        <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="/highcharts/highcharts.js"></script>
    </head>
    <body class="container-fluid">
        <header class="header">
            <nav class="navbar">
                <a class="nav-link navbar-brand" href="index.html" title="ðŸ’§ Water HighChart ðŸš°">
                    ðŸ’§ Water HighChart ðŸš°
                </a>
            </nav>
        </header>
        <main>

            <div id="water-highchart"></div>

            <script>
                const DateTime = luxon.DateTime
                const waterUsageByDay = []
                const xhr = new XMLHttpRequest()
                xhr.open("GET", "/water.json")
                xhr.onreadystatechange = async () => {
                    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                        let waterUsageData = JSON.parse(xhr.responseText)
                        for (const day of Object.values(waterUsageData)) {
                            waterUsageByDay.push([DateTime.fromISO(day.Date).toMillis(), day.Gallons])
                        }
                        const waterHighChart = new Highcharts.Chart(
                            {
                                title: { text: 'Water Usage' },
                                subtitle: { text: document.ontouchstart === undefined ? 'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in' },
                                chart: { renderTo: 'water-highchart', zoomType: 'x' },
                                xAxis: { title: { text: 'Date' }, type: 'datetime' },
                                yAxis: { title: { text: 'Gallons' } },
                                legend: { enabled: true },
                                series: [{ type: 'area', name: 'Gallons per day', data: waterUsageByDay }]
                            }
                        )
                        Highcharts.setOptions({
                            global: { useUTC: false }
                        })
                    }
                }
                xhr.send()
            </script>
        </main>
    </body>
</html>
